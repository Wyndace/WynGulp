// === WynWebKit Runner ============================================================================================================================================================================================================================================

// ==== Plugins ====================================================================================================================================================================================================================================================

import gulp from "gulp";
import browserSync from "browser-sync";

// =================================================================================================================================================================================================================================================================

// ==== Configs ====================================================================================================================================================================================================================================================

import path from "./Gulp/config/path.js"
import settings from "./Gulp/config/settings.js"

// =================================================================================================================================================================================================================================================================

// ==== Tasks ======================================================================================================================================================================================================================================================

import scssTask from "./Gulp/tasks/scss.js";
import htmlTask from "./Gulp/tasks/html.js"
import clearTask from "./Gulp/tasks/clear.js";
import imgTask from "./Gulp/tasks/img.js";
import resourcesTask from "./Gulp/tasks/resources.js";
import videoTask from "./Gulp/tasks/video.js";
import fontsTask from "./Gulp/tasks/fonts.js";
import fonts2scssTask from "./Gulp/tasks/fonts2scss.js";
import svg2spriteTask from "./Gulp/tasks/svg2sprite.js";
import faviconTask from "./Gulp/tasks/favicon.js";
import jsTask from "./Gulp/tasks/js.js";

// =================================================================================================================================================================================================================================================================

// ==== Local sync server ==========================================================================================================================================================================================================================================

const server = () => {
    browserSync.init(
        {
            server: {
                baseDir: path.root
            },
            open: false,
        }
    )
}

// =================================================================================================================================================================================================================================================================


// ==== Watching on edits ==========================================================================================================================================================================================================================================

const watcher = () => {
    gulp.watch(path.html.watch, htmlTask).on("all", browserSync.reload);
    gulp.watch(path.scss.watch, scssTask).on("all", browserSync.reload);
    gulp.watch(path.img.watch, imgTask).on("all", browserSync.reload);
    gulp.watch(path.svg.watch, svg2spriteTask).on("all", browserSync.reload);
    gulp.watch(path.resources.watch, resourcesTask).on("all", browserSync.reload);
    gulp.watch(path.video.watch, videoTask).on("all", browserSync.reload);
    gulp.watch(path.fonts.watch, fontsTask).on("all", browserSync.reload);
    gulp.watch(path.js.watch, jsTask).on("all", browserSync.reload);
    gulp.watch(path.fonts.dest + '/*.woff2', fonts2scssTask).on("all", browserSync.reload);
}

// =================================================================================================================================================================================================================================================================

// ==== Build mode =================================================================================================================================================================================================================================================

const build = gulp.series(
    clearTask,
    gulp.parallel(gulp.series(faviconTask, htmlTask), imgTask, videoTask, resourcesTask, svg2spriteTask, jsTask, gulp.series(fontsTask, fonts2scssTask, scssTask)),
);

// =================================================================================================================================================================================================================================================================


// ==== Development mode ===========================================================================================================================================================================================================================================

const dev = gulp.series(
    build,
    gulp.parallel(watcher, server)
);

// =================================================================================================================================================================================================================================================================

// ==== Exporting Tasks ============================================================================================================================================================================================================================================

export { htmlTask as html }
export { scssTask as scss }
export { clearTask as clear }
export { imgTask as img }
export { videoTask as video }
export { resourcesTask as resources }
export { fontsTask as font }
export { fonts2scssTask as fonts2scss }
export { svg2spriteTask as svg2sprite }
export { faviconTask as favicon }
export { jsTask as js }
export { dev }
export { build }


export default settings.isProd
    ? build
    : dev;

// =================================================================================================================================================================================================================================================================

// =================================================================================================================================================================================================================================================================
