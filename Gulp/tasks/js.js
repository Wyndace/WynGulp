// === JS Task =====================================================================================================================================================================================================================================================

// ==== Plugins ====================================================================================================================================================================================================================================================

import gulp from "gulp";
import plumber from "gulp-plumber";
import notify from "gulp-notify";
import babel from "gulp-babel";

import webpack from "webpack-stream";

// =================================================================================================================================================================================================================================================================


// ==== Configs ====================================================================================================================================================================================================================================================

import path from "../config/path.js"
import settings from "../config/settings.js"

// =================================================================================================================================================================================================================================================================

// ==== JS processing ==============================================================================================================================================================================================================================================


const jsTask = () => {
    gulp.src(path.js.src + '/vendor.js', {sourcemaps: settings.isDev})
        .pipe(plumber({
            errorHandler: notify.onError(error => ({
                title: "JS TASK",
                message: error
            }))
        }))
        .pipe(babel())
        .pipe(webpack({
            mode: settings.webpack.mode,
            entry: path.js.src + '/vendor.js',
            output : {
                filename: 'vendor.min.js'
            }
        }))
        .pipe(gulp.dest(path.js.dest, {sourcemaps: settings.isDev}));
    gulp.src(path.js.src + '/main.js', {sourcemaps: settings.isDev})
        .pipe(plumber({
            errorHandler: notify.onError(error => ({
                title: "JS TASK",
                message: error
            }))
        }))
        .pipe(babel())
        .pipe(webpack({
            mode: settings.webpack.mode,
            entry: path.js.src + '/main.js',
            output : {
                filename: 'main.min.js'
            }
        }))
        .pipe(gulp.dest(path.js.dest, {sourcemaps: settings.isDev}));
    return gulp.src(path.js.src + '/global.js', {sourcemaps: settings.isDev})
        .pipe(plumber({
            errorHandler: notify.onError(error => ({
                title: "JS TASK",
                message: error
            }))
        }))
        .pipe(babel())
        .pipe(webpack({
            mode: settings.webpack.mode,
            entry: path.js.src + '/global.js',
            output : {
                filename: 'global.min.js'
            }
        }))
        .pipe(gulp.dest(path.js.dest, {sourcemaps: settings.isDev}))
};

// =================================================================================================================================================================================================================================================================

// ==== Exporting Task =============================================================================================================================================================================================================================================

export default jsTask;

// =================================================================================================================================================================================================================================================================

// =================================================================================================================================================================================================================================================================