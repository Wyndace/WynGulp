// === Fonts2SCSS Task =============================================================================================================================================================================================================================================

// ==== Plugins ====================================================================================================================================================================================================================================================

import gulp from "gulp"

import fs from "fs";

// =================================================================================================================================================================================================================================================================

// ==== Configs ====================================================================================================================================================================================================================================================

import path from "../config/path.js"

// =================================================================================================================================================================================================================================================================


// ==== Fonts2SCCS processing ======================================================================================================================================================================================================================================

const weightChecker = (fontname) => {
    let weight = 400;
    switch (true) {
        case /thin/.test(fontname.toLowerCase()):
            weight = 100;
            break;
        case /extralight/.test(fontname.toLowerCase()):
            weight = 200;
            break;
        case /light/.test(fontname.toLowerCase()):
            weight = 300;
            break;
        case /regular/.test(fontname.toLowerCase()):
            weight = 400;
            break;
        case /medium/.test(fontname.toLowerCase()):
            weight = 500;
            break;
        case /semibold/.test(fontname.toLowerCase()):
            weight = 600;
            break;
        case /extrabold/.test(fontname.toLowerCase()):
            weight = 800;
            break;
        case /bold/.test(fontname.toLowerCase()):
            weight = 700;
            break;
        case /black/.test(fontname.toLowerCase()):
            weight = 900;
            break;
        case /heavy/.test(fontname.toLowerCase()):
            weight = 800;
            break;
    }
    return weight;
};

const fonts2scssTask = () => {
    const fontsFile = path.src + '/scss/_fonts.scss';
    fs.readdir(path.fonts.dest, (err, fontsFiles) => {
        if (fontsFiles) {
            if (!fs.existsSync(fontsFile)) {
                fs.writeFile(fontsFile, '', ()=>{})
                let newFont;
                for (let i = 0; i < fontsFiles.length; i++) {
                    const fontName = fontsFiles[i].split('.')[0];
                    if (newFont !== fontName) {
                        const fontWeight = weightChecker(fontName);
                        fs.appendFile(fontsFile, `@include font-face("${fontName.split("-")[0]}", "${fontName}", ${fontWeight});\r\n`, () => {});
                        newFont = fontName;
                    }
                }
            } else {
                console.log('[FONTS2SCCS TASK] scss/_fonts.scss already exists!\n[FONTS2SCCS TASK] If you want to update your fonts, delete it!')
            }
        }
    })

    return gulp.src(path.src);
};

// =================================================================================================================================================================================================================================================================

// ==== Exporting Task =============================================================================================================================================================================================================================================

export default fonts2scssTask;

// =================================================================================================================================================================================================================================================================

// =================================================================================================================================================================================================================================================================